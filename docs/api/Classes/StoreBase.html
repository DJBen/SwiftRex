<!DOCTYPE html>
<html lang="en">
  <head>
    <title>StoreBase Class Reference</title>
    <link rel="stylesheet" type="text/css" href="../css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="../css/highlight.css" />
    <meta charset='utf-8'>
    <script src="../js/jquery.min.js" defer></script>
    <script src="../js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a name="//apple_ref/swift/Class/StoreBase" class="dashAnchor"></a>
    <a title="StoreBase Class Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="../index.html">SwiftRex Docs</a> (100% documented)</p>
        <p class="header-right"><a href="https://github.com/SwiftRex/SwiftRex"><img src="../img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="../index.html">SwiftRex Reference</a>
        <img id="carat" src="../img/carat.png" />
        StoreBase Class Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="../Store (contracts).html">Store (contracts)</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Store (contracts).html#/s:8SwiftRex5StoreP">Store</a>
              </li>
              <li class="nav-group-task">
                <a href="../Store (contracts).html#/s:8SwiftRex13EventProtocolP">EventProtocol</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/EventHandler.html">EventHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/StateProvider.html">StateProvider</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Store (basic implementation).html">Store (basic implementation)</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Classes/StoreBase.html">StoreBase</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/ActionHandler.html">ActionHandler</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Reducer.html">Reducer</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Structs/Reducer.html">Reducer</a>
              </li>
              <li class="nav-group-task">
                <a href="../Reducer.html#/s:8SwiftRex14ActionProtocolP">ActionProtocol</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Middleware (basics).html">Middleware (basics)</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/Middleware.html">Middleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/BypassMiddleware.html">BypassMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/DirectLineMiddleware.html">DirectLineMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/ComposedMiddleware.html">ComposedMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Middleware (basics).html#/s:8SwiftRex2lgoiyAA18ComposedMiddlewareCy9StateTypeQzGx_q_tAA0E0RzAaHR_AEQy_AFRSr0_lF">&lt;&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/SubstateMiddleware.html">SubstateMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/AnyMiddleware.html">AnyMiddleware</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Side-Effects.html">Side-Effects</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/SideEffectMiddleware.html">SideEffectMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/SideEffectProducer.html">SideEffectProducer</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/SideEffectError.html">SideEffectError</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/AnySideEffectProducer.html">AnySideEffectProducer</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Composition helpers.html">Composition helpers</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/Monoid.html">Monoid</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Closure type-aliases.html">Closure type-aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Closure type-aliases.html#/EventEvaluation">EventEvaluation</a>
              </li>
              <li class="nav-group-task">
                <a href="../Closure type-aliases.html#/s:8SwiftRex8GetStatea">GetState</a>
              </li>
              <li class="nav-group-task">
                <a href="../Closure type-aliases.html#/s:8SwiftRex17NextActionHandlera">NextActionHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="../Closure type-aliases.html#/s:8SwiftRex16NextEventHandlera">NextEventHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="../Closure type-aliases.html#/s:8SwiftRex14ReduceFunctiona">ReduceFunction</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            <h1>StoreBase</h1>
              <div class="declaration">
                <div class="language">
                  <pre class="highlight swift"><code><span class="kd">open</span> <span class="kd">class</span> <span class="kt">StoreBase</span><span class="o">&lt;</span><span class="kt">E</span><span class="o">&gt;</span> <span class="p">:</span> <span class="kt"><a href="../Store (contracts).html#/s:8SwiftRex5StoreP">Store</a></span><span class="p">,</span> <span class="kt"><a href="../Protocols/ActionHandler.html">ActionHandler</a></span></code></pre>

                </div>
              </div>
            <p>üè™ <code><a href="../Store (contracts).html#/s:8SwiftRex5StoreP">Store</a></code> defines a protocol for the state store of an app. It must have an input and an output:</p>

<ul>
<li>an <code><a href="../Protocols/EventHandler.html">EventHandler</a></code>: that&rsquo;s the store input, so it&rsquo;s able to receive and distribute events of type <code><a href="../Store (contracts).html#/s:8SwiftRex13EventProtocolP">EventProtocol</a></code>. Being an event handler means that an <code>UIViewController</code> can dispatch events to it, such as <code>.userTappedButtonX</code>, <code>.didScrollToPosition(_:)</code>, <code>.viewDidLoad</code> or <code>queryTextFieldChangedTo(_:)</code>.</li>
<li>a <code><a href="../Protocols/StateProvider.html">StateProvider</a></code>: that&rsquo;s the store output, so the system can subscribe a store for updates on State. Being a state provider basically means that store is an Observable<T>, where T is the State of your app, so an <code>UIViewController</code> can subscribe to state changes and react to them.</li>
</ul>

<p>The store will glue all the parts together and its responsibility is being a proxy to the non-Redux world. For that reason, it&rsquo;s correct to say that a <code><a href="../Store (contracts).html#/s:8SwiftRex5StoreP">Store</a></code> is the single point of contact with <code>UIKit</code> and it&rsquo;s a class that you want to inject as a dependency on all the ViewControllers, either as one single dependency or, preferably, a dependency for each of its protocols - <code><a href="../Protocols/EventHandler.html">EventHandler</a></code> and <code><a href="../Protocols/StateProvider.html">StateProvider</a></code> -, both eventually pointing to the same instance.</p>

<p><img src="https://swiftrex.github.io/SwiftRex/markdown/img/StoreBase.png" alt="Store and ViewController"></p>

<p>In its documentation, Apple suggests some communication patterns between the MVC layers. Most important, they say that Controllers should update the Model, who notifies the Controller about changes:</p>

<p><img src="https://swiftrex.github.io/SwiftRex/markdown/img/CocoaMVC.gif" alt="iOS MVC"></p>

<p>You can think of Store as a very heavy <q>Model</q> layer, completely detached from the View and Controller, and where all the business logic stands. At a first sight it may look like transfering the <q>Massive</q> problem from a layer to another, but later in this docs it&rsquo;s gonna be clear how the logic will be split and, hopefully, by having specialized middlewares we can even start sharing more code between different apps or different devices such as Apple TV, macOS, iOS, watchOS or backend APIs, thanks to the business decisions being completely off your presentation layer.</p>

<p>You want only one Store in your app, so either you create a singleton or a public property in a long-life class such as AppDelegate or AppCoordinator. That&rsquo;s crucial for making the store completely detached from the <code>UIKit</code> world. Theoretically it should be possible to keep multiple stores - one per module or per <code>UIViewController</code> - and keep them in sync through Rx observation, like the <q>Flux</q> approach. However, the main goal of SwiftRex is to keep an unified state independent from <code>UIKit</code>, therefore it&rsquo;s the recommended approach.</p>

<p>The <code>StoreBase</code> implementation also is:</p>

<ul>
<li>an <code><a href="../Protocols/ActionHandler.html">ActionHandler</a></code>: be able to receive and distribute actions of type <code><a href="../Reducer.html#/s:8SwiftRex14ActionProtocolP">ActionProtocol</a></code></li>
</ul>

<p>A <code>StoreBase</code> uses <code><a href="../Protocols/Middleware.html">Middleware</a></code> pipeline and <code><a href="../Structs/Reducer.html">Reducer</a></code> pipeline. It creates a queue of incoming events that is handled to the middleware pipeline, which triggers actions back to the store. These actions are put in a queue that again are handled to the middleware pipeline, usually for logging or analytics purposes. The actions are them forwarded to the <code><a href="../Structs/Reducer.html">Reducer</a></code> pipeline, together with the current state. One by one, the reducers will handle the action and incrementally change a copy of the app state. When this process is done, the store takes the resulting state, sets it as the current state and notifies all subscribers.</p>

<p><img src="https://swiftrex.github.io/SwiftRex/markdown/img/StoreInternals.png" alt="Store internals"></p>

          </section>
          <section class="section task-group-section">
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex9StoreBaseC12initialState7reducer10middlewareACyxGx_AA7ReducerVyxGqd__tc0F4TypeQyd__RszAA10MiddlewareRd__lufc"></a>
                    <a name="//apple_ref/swift/Method/init(initialState:reducer:middleware:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex9StoreBaseC12initialState7reducer10middlewareACyxGx_AA7ReducerVyxGqd__tc0F4TypeQyd__RszAA10MiddlewareRd__lufc">init(initialState:reducer:middleware:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Required initializer that takes all the expected pipelines</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">init</span><span class="o">&lt;</span><span class="kt">M</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">initialState</span><span class="p">:</span> <span class="kt">E</span><span class="p">,</span> <span class="nv">reducer</span><span class="p">:</span> <span class="kt"><a href="../Structs/Reducer.html">Reducer</a></span><span class="o">&lt;</span><span class="kt">E</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">middleware</span><span class="p">:</span> <span class="kt">M</span><span class="p">)</span> <span class="k">where</span> <span class="kt">E</span> <span class="o">==</span> <span class="kt">M</span><span class="o">.</span><span class="kt">StateType</span><span class="p">,</span> <span class="kt">M</span> <span class="p">:</span> <span class="kt"><a href="../Protocols/Middleware.html">Middleware</a></span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>initialState</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>when an app is starting, how should be its state struct? Initialize the state and set it before creating the <code><a href="../Store (contracts).html#/s:8SwiftRex5StoreP">Store</a></code></p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>reducer</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>a reducer function wrapped in a monoid container of type <code><a href="../Structs/Reducer.html">Reducer</a></code>, able to handle the state of the same type as the <code>initialState</code> property. For <code>reducer</code> composition, please use the diamond operator (<code>&lt;&gt;</code>) and for reducers that understand only a sub-state part, use the <code><a href="../Structs/Reducer.html#/s:8SwiftRex7ReducerV4liftyACyqd__Gs15WritableKeyPathCyqd__xGlF">Reducer.lift(_:)</a></code> method</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>middleware</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>a middleware pipeline, that can be any flat middleware or a <code><a href="../Classes/ComposedMiddleware.html">ComposedMiddleware</a></code>, as long as it&rsquo;s able to handle the state of the same type as the <code>initialState</code> property. For <code>middleware</code> composition, please use the diamond operator (<code>&lt;&gt;</code>) and for middlewares that understand only a sub-state part, use the <code><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewarePAAE4liftyAA08SubstateC0Cyqd__xGs15WritableKeyPathCyqd__9StateTypeQzGlF">Middleware.lift(_:)</a></code> method</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex9StoreBaseC12initialState7reducerACyxGx_AA7ReducerVyxGtcfc"></a>
                    <a name="//apple_ref/swift/Method/init(initialState:reducer:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex9StoreBaseC12initialState7reducerACyxGx_AA7ReducerVyxGtcfc">init(initialState:reducer:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Convenience initializer that takes all the expected pipelines expect the <code><a href="../Protocols/Middleware.html">Middleware</a></code>, that points to the neutral case of a middleware, the <code><a href="../Classes/BypassMiddleware.html">BypassMiddleware</a></code> class.</p>

<ul>
<li>initialState: when an app is starting, how should be its state struct? Initialize the state and set it before creating the <code><a href="../Store (contracts).html#/s:8SwiftRex5StoreP">Store</a></code></li>
<li>reducer: a reducer function wrapped in a monoid container of type <code><a href="../Structs/Reducer.html">Reducer</a></code>, able to handle the state of the same type as the <code>initialState</code> property. For <code>reducer</code> composition, please use the diamond operator (<code>&lt;&gt;</code>) and for reducers that understand only a sub-state part, use the <code><a href="../Structs/Reducer.html#/s:8SwiftRex7ReducerV4liftyACyqd__Gs15WritableKeyPathCyqd__xGlF">Reducer.lift(_:)</a></code> method</li>
</ul>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="n">convenience</span> <span class="nf">init</span><span class="p">(</span><span class="nv">initialState</span><span class="p">:</span> <span class="kt">E</span><span class="p">,</span> <span class="nv">reducer</span><span class="p">:</span> <span class="kt"><a href="../Structs/Reducer.html">Reducer</a></span><span class="o">&lt;</span><span class="kt">E</span><span class="o">&gt;</span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex9StoreBaseC8dispatchyyAA13EventProtocol_pF"></a>
                    <a name="//apple_ref/swift/Method/dispatch(_:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex9StoreBaseC8dispatchyyAA13EventProtocol_pF">dispatch(_:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Because <code>StoreBase</code> is an <code><a href="../Protocols/EventHandler.html">EventHandler</a></code>, it provides a way for an <code>UIViewController</code> or other classes in the boundaries of the device sensors to communicate and dispatch their events.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">open</span> <span class="kd">func</span> <span class="nf">dispatch</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt"><a href="../Store (contracts).html#/s:8SwiftRex13EventProtocolP">EventProtocol</a></span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>event</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>the event to be managed by this store and handled by its middlewares</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex9StoreBaseC7triggeryyAA14ActionProtocol_pF"></a>
                    <a name="//apple_ref/swift/Method/trigger(_:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex9StoreBaseC7triggeryyAA14ActionProtocol_pF">trigger(_:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Because <code>StoreBase</code> is an <code><a href="../Protocols/ActionHandler.html">ActionHandler</a></code>, it provides a way for a <code><a href="../Protocols/Middleware.html">Middleware</a></code> to trigger their actions, usually in response to events or async operations.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">open</span> <span class="kd">func</span> <span class="nf">trigger</span><span class="p">(</span><span class="n">_</span> <span class="nv">action</span><span class="p">:</span> <span class="kt"><a href="../Reducer.html#/s:8SwiftRex14ActionProtocolP">ActionProtocol</a></span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>action</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>the action to be managed by this store and handled by its middlewares and reducers</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/"></a>
                    <a name="//apple_ref/swift/Method/subscribe(_:)" class="dashAnchor"></a>
                    <a class="token" href="#/">subscribe(_:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Because <code>StoreBase</code> is a <code><a href="../Protocols/StateProvider.html">StateProvider</a></code>, it exposes a way for an <code>UIViewController</code> or other interested classes to subscribe to <code>State</code> changes.</p>

<p>By default, this observation will have the following characteristics:</p>

<ul>
<li>Hot observable, no observation side-effect</li>
<li>Replays the last (or initial) state</li>
<li>Never completes</li>
<li>Never fails</li>
<li>Observes on the <code>MainScheduler</code></li>
</ul>

<p>Internally it maps to a <code>BehaviorSubject&lt;StateType&gt;</code>.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">func</span> <span class="n">subscribe</span><span class="o">&lt;</span><span class="kt">O</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">observer</span><span class="p">:</span> <span class="kt">O</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Disposable</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>observer</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>the action to be managed by this store and handled by its middlewares and reducers</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div>
                        <h4>Return Value</h4>
                        <p>Subscription for <code>observer</code> that should be kept in a <code>disposeBag</code> for the same lifetime as its observer.</p>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </section>
        </section>
        <section id="footer">
          <p>&copy; 2018 <a class="link" href="https://github.com/SwiftRex/SwiftRex" target="_blank" rel="external">SwiftRex</a>. All rights reserved. (Last updated: 2018-10-25)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ‚ô™‚ô´ v0.9.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
