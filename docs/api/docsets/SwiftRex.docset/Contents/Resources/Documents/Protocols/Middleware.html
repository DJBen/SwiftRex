<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Middleware Protocol Reference</title>
    <link rel="stylesheet" type="text/css" href="../css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="../css/highlight.css" />
    <meta charset='utf-8'>
    <script src="../js/jquery.min.js" defer></script>
    <script src="../js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a name="//apple_ref/swift/Protocol/Middleware" class="dashAnchor"></a>
    <a title="Middleware Protocol Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="../index.html">SwiftRex Docs</a> (100% documented)</p>
        <p class="header-right"><a href="https://github.com/SwiftRex/SwiftRex"><img src="../img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="../index.html">SwiftRex Reference</a>
        <img id="carat" src="../img/carat.png" />
        Middleware Protocol Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="../Store%20%28contracts%29.html">Store (contracts)</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/StateProvider.html">StateProvider</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Store%20%28basic%20implementation%29.html">Store (basic implementation)</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/ActionHandler.html">ActionHandler</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Reducer.html">Reducer</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Structs/Reducer.html">Reducer</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Middleware%20%28basics%29.html">Middleware (basics)</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/Middleware.html">Middleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/ComposedMiddleware.html">ComposedMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Middleware%20%28basics%29.html#/s:8SwiftRex2lgoiyAA18ComposedMiddlewareCy15InputActionTypeQz06OutputgH0Qz05StateH0QzGx_q_tAA0E0RzAaLR_AEQy_AFRSAGQy_AHRSAIQy_AJRSr0_lF">&lt;&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/AnyMiddleware.html">AnyMiddleware</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Composition%20helpers.html">Composition helpers</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/Monoid.html">Monoid</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Closure%20type-aliases.html">Closure type-aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Closure%20type-aliases.html#/s:8SwiftRex8GetStatea">GetState</a>
              </li>
              <li class="nav-group-task">
                <a href="../Closure%20type-aliases.html#/s:8SwiftRex14ReduceFunctiona">ReduceFunction</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Other%20Classes.html">Other Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Classes/IdentityMiddleware.html">IdentityMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/LiftMiddleware.html">LiftMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/PipelineMiddleware.html">PipelineMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/ReduxStoreBase.html">ReduxStoreBase</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Other%20Protocols.html">Other Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/ReduxStoreProtocol.html">ReduxStoreProtocol</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/Semigroup.html">Semigroup</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/StoreType.html">StoreType</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/SubscriptionCollection.html">SubscriptionCollection</a>
              </li>
              <li class="nav-group-task">
                <a href="../Protocols/SubscriptionType.html">SubscriptionType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Other%20Structs.html">Other Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Structs/MiddlewareContext.html">MiddlewareContext</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/PublisherType.html">PublisherType</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/ReduxPipelineWrapper.html">ReduxPipelineWrapper</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/ReplayLastSubjectType.html">ReplayLastSubjectType</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/ShouldEmitValue.html">ShouldEmitValue</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/SubjectType.html">SubjectType</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/SubscriberType.html">SubscriberType</a>
              </li>
              <li class="nav-group-task">
                <a href="../Structs/ViewStore.html">ViewStore</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Other%20Typealiases.html">Other Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Other%20Typealiases.html#/s:8SwiftRex4Nexta">Next</a>
              </li>
              <li class="nav-group-task">
                <a href="../Other%20Typealiases.html#/s:8SwiftRex23UnfailablePublisherTypea">UnfailablePublisherType</a>
              </li>
              <li class="nav-group-task">
                <a href="../Other%20Typealiases.html#/s:8SwiftRex31UnfailableReplayLastSubjectTypea">UnfailableReplayLastSubjectType</a>
              </li>
              <li class="nav-group-task">
                <a href="../Other%20Typealiases.html#/s:8SwiftRex17UnfailableSubjecta">UnfailableSubject</a>
              </li>
              <li class="nav-group-task">
                <a href="../Other%20Typealiases.html#/s:8SwiftRex24UnfailableSubscriberTypea">UnfailableSubscriberType</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            <h1>Middleware</h1>
              <div class="declaration">
                <div class="language">
                  <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">Middleware</span> <span class="p">:</span> <span class="kt">AnyObject</span></code></pre>

                </div>
              </div>
            <p>â›“ <code>Middleware</code> is a plugin, or a composition of several plugins, that are assigned to the <code>Store</code> pipeline in order
to handle each action received (<code>InputActionType</code>), to execute side-effects in response, and eventually dispatch more
action (<code>OutputActionType</code>) in the process. This happens before the <code><a href="../Structs/Reducer.html">Reducer</a></code> to do its job. So in other words, we can
think of a Middleware as an object that transforms actions into sync or async tasks and create more actions as these
side-effects complete, also being able to check the current state at any point.</p>

<p>An action is a lightweight structure that is dispatched into the <code>Store</code>. The store enqueues a new action that arrives
and submits it to a pipeline of middlewares. So, in other words, a <code>Middleware</code> is class that handles actions, and has
the power to dispatch more actions to the <code><a href="../Protocols/ActionHandler.html">ActionHandler</a></code> chain. The <code>Middleware</code> can ignore the action and simply
delegate to the next node in the chain of middlewares, or it can execute side-effects in response, such as logging into
file or over the network, or execute http requests, for example. In case of those async tasks, when they complete the
middleware can dispatch new actions containing a payload with the response (a JSON file, an array of movies,
credentials, etc). Other middlewares will handle that, or maybe even the same middleware in a future RunLoop, or
perhaps some <code><a href="../Structs/Reducer.html">Reducer</a></code>, as reducers pipeline is at the end of every middleware pipeline.</p>

<p>Because we control when the next node will be called, we can for example collect the state before and after reducers
have changed the state, which can be very interesting for logging, auditing, analytics tracking, telemetry or state
synchronization with external devices, such as Apple Watches or for debugging tools over the network.</p>

<p>So let&rsquo;s imagine a movie catalog app where a <code>MovieListAction.didTapWatchToggle(rowIndex:)</code> action would be handled by
a <code>Middleware</code> that checks the state and finds that current list has certain movie at the given row index, and this
movie has been already marked as watched before. The <code>Middleware</code> was able to learn that thanks to the
<code>getState: @escaping () -&gt; StateType</code> closure present in the property <code>context</code> of type <code><a href="../Structs/MiddlewareContext.html">MiddlewareContext</a></code>, which can
be checked at any point to read an updated state. Our example <code>Middleware</code> then will trigger a
<code>MovieListAction.setMovieAsUnwatched(movieId:)</code> action to be handled by itself, other middlewares or the <code><a href="../Structs/Reducer.html">Reducer</a></code> chain.</p>

<p>However, this would be a very naive implementation. Most of the times we handle data that must be persisted in a
database or through a REST API. State only lives in memory, but before changing the memory we should at least start
Side-Effects. Let&rsquo;s revisit the example above and say that we got a <code>MovieListAction.didTapWatchToggle(rowIndex:)</code>
action. Yes, we still should check what movie is at that row and whether or not it&rsquo;s watched. Now, we can trigger an
http task requesting our API to mark it as unwatched. Because this request is asynchronous we have three options:</p>

<ul>
<li>assume that this API won&rsquo;t fail, and mark the movie immediately as unwatched;</li>
<li>don&rsquo;t assume anything and wait for the <code>HTTPResponse</code>;</li>
<li>provide a very precise state management, meaning that we immediately change the state of our movie to <q>it&rsquo;s being
changed</q> and, once we get the response we update again.</li>
</ul>

<p>In the first case, we create the <code>URLSessionDataTask</code>, call <code>task.resume()</code> and immediately trigger the
<code>setMovieAsUnwatched</code> action for the reducer to update the app state. We may use the completion handler of the
<code>HTTPRequest</code> to confirm the successful result and rollback if needed, by sending another action so the reducer will
revert the change in the state, and the UI will then react to that.</p>

<p>In the second case, after calling <code>task.resume()</code> we don&rsquo;t trigger any action, only when we get the response we trigger
the action that will eventually change the state and the UI, of course in case it was a successful response.</p>

<p>The third case, however, offers many more possibilities. You can think about the possible three states of a movie:
watched, not watched, mutating. You can even split the <q>mutating</q> case in two: <q>mutating to watched</q> and <q>mutating to
unwatched</q>. So instead of a boolean with <code>true</code> or <code>false</code>, now your state is an enum with four cases, describing
precisely the situation of your element. What you get from that is the ability to perform better animations, improved
UI features like disable the <q>watch</q> button while the change is being requested, use activity indicators view or simply
ignore further attempts to click the Toggle in the screen, by ignoring the events while the movie is in this intermediate
situation. To offer that, you call <code>task.resume</code> and immediately trigger an Action <code>setMovieAsUnwatchRequestInProgress</code>,
which will eventually set the state accordingly, while inside the response completion handler you evaluate the response
and trigger another action to update the movie state again, by triggering either <code>setMovieAsUnwatched</code> in case of
successful response, or back to <code>setMovieAsWatched</code> if the operation fails. In case of failure you may also consider
to trigger an additional Action <code>gotError</code> so you notify the user, or maybe implement a retry.</p>

<p>Because the <code>Middleware</code> receive all actions and accesses the state of the app at any point, anything can be done from
these small and reusable boxes. For example, the same <code>CoreLocation</code> middleware could be used from an iOS app, its
extensions, the Apple Watch extension or even different apps, as long as they share some sub-state struct.</p>

<p>Some suggestions of middlewares:</p>

<ul>
<li>Run Timers, pooling some external resource or updating some local state at a constant time</li>
<li>Subscribe for <code>CoreData</code>, <code>Realm</code>, <code>Firebase Realtime Database</code> or equivalent database changes</li>
<li>Be a <code>CoreLocation</code> delegate, checking for significant location changes or beacon ranges and triggering actions to
update the state</li>
<li>Be a <code>HealthKit</code> delegate to track activities, or even combining that with <code>CoreLocation</code> observation in order to
track the activity route</li>
<li>Logger, Telemetry, Auditing, Analytics tracker, Crash report breadcrumbs</li>
<li><code>WatchConnectivity</code> sync, keep iOS and watchOS state in sync</li>
<li>Monitoring or debugging tools, like external apps to monitor the state and actions remotely from a different device</li>
<li>API calls and other <q>cold observables</q></li>
<li>Network Reachability</li>
<li>Navigation through the app (Redux Coordinator pattern)</li>
<li><code>CoreBluetooth</code> central or peripheral manager</li>
<li><code>CoreNFC</code></li>
<li><code>NotificationCenter</code> and other delegates</li>
<li><code>RxSwift</code> observables, <code>ReactiveSwift</code> signal producers, <code>Combine</code> publishers</li>
<li>Observation of traits changes, device rotation, language/locale, dark mode, dynamic fonts, background/foreground state</li>
<li>Any side-effect, I/O, networking, sensors, third-party libraries that you want to abstract</li>
</ul>

<p>When implementing your Middleware, all you have to do is to handle the incoming actions:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">MyMiddleware</span><span class="p">:</span> <span class="kt">Middleware</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">context</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">MiddlewareContext</span><span class="o">&lt;</span><span class="kt">SomeActionType</span><span class="p">,</span> <span class="kt">SomeStateType</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"Store will set this"</span><span class="p">)</span> <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="kt">SomeActionType</span><span class="p">,</span> <span class="nv">next</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="kt">Next</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">action</span> <span class="o">==</span> <span class="o">.</span><span class="n">requestNetwork</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">next</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="nf">requestMyFavoriteAPI</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
            <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
            <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">value</span><span class="p">):</span> <span class="nf">context</span><span class="p">()</span><span class="o">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="o">.</span><span class="nf">gotSuccessfulValue</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">):</span> <span class="nf">context</span><span class="p">()</span><span class="o">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="o">.</span><span class="nf">gotFailure</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
            <span class="p">}</span>
        <span class="p">})</span>

        <span class="nf">next</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Some important notes about the code above, and generally speaking about any middleware:</p>

<ul>
<li>Always call <code>next()</code>. If you have an early exit by using <code>guard</code>, don&rsquo;t forget to call there and in the regular case too.</li>
<li>Never call <code>next()</code> more than once. Seriously, you don&rsquo;t want that.</li>
<li>Most of the time you can consider calling <code>next()</code> in a <code>defer</code> block put at the beginning of your function.</li>
<li>Although that would work somehow, please don&rsquo;t call <code>next()</code> in a callback or dispatch queue async/sync block. Call it
exactly in the thread you got it, and in the same runloop. Unless you REALLY know what you&rsquo;re doing.</li>
<li><p>Anything before <code>next()</code> happens before the state change, what comes after <code>next()</code> will happen after the reducer chain
so you can you that to track state changes:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="kt">SomeActionType</span><span class="p">,</span> <span class="nv">next</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="kt">Next</span><span class="p">)</span> <span class="p">{</span>
<span class="k">let</span> <span class="nv">stateBefore</span> <span class="o">=</span> <span class="nf">context</span><span class="p">()</span><span class="o">.</span><span class="nf">getState</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">dateBefore</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">()</span>

<span class="nf">next</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">stateAfter</span> <span class="o">=</span> <span class="nf">context</span><span class="p">()</span><span class="o">.</span><span class="nf">getState</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">dateAfter</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">()</span>

<span class="nf">log</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span> <span class="nv">before</span><span class="p">:</span> <span class="n">stateBefore</span><span class="p">,</span> <span class="nv">after</span><span class="p">:</span> <span class="n">stateAfter</span><span class="p">,</span> <span class="nv">dateBefore</span><span class="p">:</span> <span class="n">dateBefore</span><span class="p">,</span> <span class="nv">dateAfter</span><span class="p">:</span> <span class="n">dateAfter</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></li>
</ul>

          </section>
          <section class="section task-group-section">
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex10MiddlewareP15InputActionTypeQa"></a>
                    <a name="//apple_ref/swift/Alias/InputActionType" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex10MiddlewareP15InputActionTypeQa">InputActionType</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>The Action type that this <code>Middleware</code> knowns how to handle, so the store will forward actions of this type to this
middleware. Thanks to optics, this action can be a sub-action lifted to a global action type. Please check
<code><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewarePAAE4lift12actionZoomIn0eF3Out05statefG0AA04LiftC0Cyqd__qd_0_qd_1_xG15InputActionTypeQzSgqd__c_qd_0_06OutputlM0Qzc05StateM0Qzqd_1_ctr1_lF">lift(actionZoomIn:actionZoomOut:stateZoomIn:)</a></code> for more details.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">associatedtype</span> <span class="kt">InputActionType</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex10MiddlewareP16OutputActionTypeQa"></a>
                    <a name="//apple_ref/swift/Alias/OutputActionType" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex10MiddlewareP16OutputActionTypeQa">OutputActionType</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>The Action type that this <code>Middleware</code> will eventually trigger back to the store in response of side-effects. This
can be the same as <code><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewareP15InputActionTypeQa">InputActionType</a></code> or different, in case you want to separate your enum in requests and responses.
Thanks to optics, this action can be a sub-action lifted to a global action type. Please check
<code><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewarePAAE4lift12actionZoomIn0eF3Out05statefG0AA04LiftC0Cyqd__qd_0_qd_1_xG15InputActionTypeQzSgqd__c_qd_0_06OutputlM0Qzc05StateM0Qzqd_1_ctr1_lF">lift(actionZoomIn:actionZoomOut:stateZoomIn:)</a></code> for more details.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">associatedtype</span> <span class="kt">OutputActionType</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex10MiddlewareP9StateTypeQa"></a>
                    <a name="//apple_ref/swift/Alias/StateType" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex10MiddlewareP9StateTypeQa">StateType</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>The State that this <code>Middleware</code> knowns how to handle. Thanks to lenses, this state can be a sub-state lifted to
a global state. Please check <code><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewarePAAE4lift12actionZoomIn0eF3Out05statefG0AA04LiftC0Cyqd__qd_0_qd_1_xG15InputActionTypeQzSgqd__c_qd_0_06OutputlM0Qzc05StateM0Qzqd_1_ctr1_lF">lift(actionZoomIn:actionZoomOut:stateZoomIn:)</a></code> for more details.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">associatedtype</span> <span class="kt">StateType</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex10MiddlewareP7contextAA0C7ContextVy16OutputActionTypeQz05StateH0QzGycvp"></a>
                    <a name="//apple_ref/swift/Property/context" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex10MiddlewareP7contextAA0C7ContextVy16OutputActionTypeQz05StateH0QzGycvp">context</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Every <code>Middleware</code> needs some context in order to be able to interface with other middleware and with the store.
This context includes ways to fetch the most up-to-date state or dispatch new actions.
When implementing your own Middleware, the initial value of this property can be a closure that simply crashes with
fatal error, because once the middleware is added to the <code>Store</code> or to a pipeline of composed middlewares, this
value will point to the store actions.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="k">var</span> <span class="nv">context</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt"><a href="../Structs/MiddlewareContext.html">MiddlewareContext</a></span><span class="o">&lt;</span><span class="kt"><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewareP16OutputActionTypeQa">OutputActionType</a></span><span class="p">,</span> <span class="kt"><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewareP9StateTypeQa">StateType</a></span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex10MiddlewareP6handle6action4nexty15InputActionTypeQz_yyctF"></a>
                    <a name="//apple_ref/swift/Method/handle(action:next:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex10MiddlewareP6handle6action4nexty15InputActionTypeQz_yyctF">handle(action:next:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Handles the incoming actions and may or not start async tasks, check the latest state at any point or dispatch
additional actions. This is also a good place for analytics, tracking, logging and telemetry.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="kt"><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewareP15InputActionTypeQa">InputActionType</a></span><span class="p">,</span> <span class="nv">next</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="kt"><a href="../Other%20Typealiases.html#/s:8SwiftRex4Nexta">Next</a></span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>action</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>the action to be handled</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>next</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>opportunity to call the next middleware in the chain and, eventually, the reducer pipeline. Call it
  only once, not more or less than once. Call it from the same thread and runloop where the handle function
  is executed, never from a completion handler or dispatch queue block. In case you don&rsquo;t need to compare
  state before and after it&rsquo;s changed from the reducers, please consider to add a <code>defer</code> block with <code>next()</code>
  on it, at the beginning of <code>handle</code> function.</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex10MiddlewarePAAE4lift12actionZoomIn0eF3Out05statefG0AA04LiftC0Cyqd__qd_0_qd_1_xG15InputActionTypeQzSgqd__c_qd_0_06OutputlM0Qzc05StateM0Qzqd_1_ctr1_lF"></a>
                    <a name="//apple_ref/swift/Method/lift(actionZoomIn:actionZoomOut:stateZoomIn:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex10MiddlewarePAAE4lift12actionZoomIn0eF3Out05statefG0AA04LiftC0Cyqd__qd_0_qd_1_xG15InputActionTypeQzSgqd__c_qd_0_06OutputlM0Qzc05StateM0Qzqd_1_ctr1_lF">lift(actionZoomIn:actionZoomOut:stateZoomIn:)</a>
                    </code>
                      <span class="declaration-note">
                        Extension method
                      </span>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>A lenses method. The global state of your app is <em>Whole</em>, and the <code>Middleware</code> handles <em>Part</em>, that is a sub-state.
So for example you may want to have a <code>GPSMiddleware</code> that knows about the following <code>struct</code>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Location</span> <span class="p">{</span>
   <span class="k">let</span> <span class="nv">latitude</span><span class="p">:</span> <span class="kt">Double</span>
   <span class="k">let</span> <span class="nv">longitude</span><span class="p">:</span> <span class="kt">Double</span>
<span class="p">}</span>
</code></pre>

<p>Let&rsquo;s call it <code>Part</code>. Both, this state and its middleware will be part of an external framework, used by dozens of apps. Internally probably the <code>Middleware</code> will use <code>CoreLocation</code> to fetch the GPS changes, and triggers some actions. On the main app we have a global state, that we now call <code>Whole</code>.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">MyGlobalState</span> <span class="p">{</span>
   <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
   <span class="k">let</span> <span class="nv">listOfItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">Item</span><span class="p">]</span>
   <span class="k">let</span> <span class="nv">currentLocation</span><span class="p">:</span> <span class="kt">Location</span>
<span class="p">}</span>
</code></pre>

<p>As expected, <code>Part</code> is a property of <code>Whole</code>, maybe not directly, it could be several nodes deep in the tree.</p>

<p>Because our <code>Store</code> understands <code>Whole</code> and our <code>GPSMiddleware</code> understands <code>Part</code>, we must <code>lift(_:)</code> the middleware to the <code>Whole</code> level, by using:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">globalStateMiddleware</span> <span class="o">=</span> <span class="n">gpsMiddleware</span><span class="o">.</span><span class="nf">lift</span><span class="p">(</span><span class="err">\</span><span class="kt">MyGlobalState</span><span class="o">.</span><span class="n">currentLocation</span><span class="p">)</span>
</code></pre>

<p>Now this middleware can be used within our <code>Store</code> or even composed with others. It also can be used in other apps as long as we have a way to lift it to the world of <code>Whole</code>.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">func</span> <span class="n">lift</span><span class="o">&lt;</span><span class="kt">GlobalInputActionType</span><span class="p">,</span> <span class="kt">GlobalOutputActionType</span><span class="p">,</span> <span class="kt">GlobalStateType</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nv">actionZoomIn</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">GlobalInputActionType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt"><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewareP15InputActionTypeQa">InputActionType</a></span><span class="p">?,</span>
    <span class="nv">actionZoomOut</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt"><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewareP16OutputActionTypeQa">OutputActionType</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">GlobalOutputActionType</span><span class="p">,</span>
    <span class="nv">stateZoomIn</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">GlobalStateType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt"><a href="../Protocols/Middleware.html#/s:8SwiftRex10MiddlewareP9StateTypeQa">StateType</a></span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kt"><a href="../Classes/LiftMiddleware.html">LiftMiddleware</a></span><span class="o">&lt;</span><span class="kt">GlobalInputActionType</span><span class="p">,</span> <span class="kt">GlobalOutputActionType</span><span class="p">,</span> <span class="kt">GlobalStateType</span><span class="p">,</span> <span class="k">Self</span><span class="o">&gt;</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>substatePath</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>the keyPath that goes from <code>Whole</code> to <code>Part</code></p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div>
                        <h4>Return Value</h4>
                        <p>a <code>SubstateMiddleware</code><code>&lt;Whole, Self&gt;</code> that knows how to translate <code>Whole</code> to <code>Part</code> and vice-versa, by using the key path.</p>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </section>
        </section>
        <section id="footer">
          <p>&copy; 2019 <a class="link" href="https://github.com/SwiftRex/SwiftRex" target="_blank" rel="external">SwiftRex</a>. All rights reserved. (Last updated: 2019-11-30)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy â™ªâ™« v0.11.2</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
