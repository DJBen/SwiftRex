<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Reducer  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a name="//apple_ref/swift/Section/Reducer" class="dashAnchor"></a>
    <a title="Reducer  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">SwiftRex Docs</a> (80% documented)</p>
        <p class="header-right"><a href="https://github.com/SwiftRex/SwiftRex"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">SwiftRex Reference</a>
        <img id="carat" src="img/carat.png" />
        Reducer  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Store%20%28contracts%29.html">Store (contracts)</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/StateProvider.html">StateProvider</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Store%20%28basic%20implementation%29.html">Store (basic implementation)</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/ActionHandler.html">ActionHandler</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Reducer.html">Reducer</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/Reducer.html">Reducer</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Middleware%20%28basics%29.html">Middleware (basics)</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/Middleware.html">Middleware</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ComposedMiddleware.html">ComposedMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="Middleware%20%28basics%29.html#/s:8SwiftRex2lgoiyAA12AfterReducerVAD_ADtF">&lt;&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Middleware%20%28basics%29.html#/s:8SwiftRex2lgoiyAA18ComposedMiddlewareVy15InputActionTypeQz06OutputgH0Qz05StateH0QzGx_q_tAA0E0RzAaLR_AEQy_AFRSAGQy_AHRSAIQy_AJRSr0_lF">&lt;&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AnyMiddleware.html">AnyMiddleware</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Composition%20helpers.html">Composition helpers</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/Monoid.html">Monoid</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Closure%20type-aliases.html">Closure type-aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Closure%20type-aliases.html#/s:8SwiftRex8GetStatea">GetState</a>
              </li>
              <li class="nav-group-task">
                <a href="Closure%20type-aliases.html#/s:8SwiftRex14ReduceFunctiona">ReduceFunction</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other%20Classes.html">Other Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ReduxStoreBase.html">ReduxStoreBase</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other%20Extensions.html">Other Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Collection.html">Collection</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/DispatchQueue.html">DispatchQueue</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other%20Protocols.html">Other Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/ReduxStoreProtocol.html">ReduxStoreProtocol</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Semigroup.html">Semigroup</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/StoreType.html">StoreType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SubscriptionCollection.html">SubscriptionCollection</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SubscriptionType.html">SubscriptionType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other%20Structs.html">Other Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/ActionSource.html">ActionSource</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AfterReducer.html">AfterReducer</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AnyActionHandler.html">AnyActionHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AnyStateProvider.html">AnyStateProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AnyStoreType.html">AnyStoreType</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/IdentityMiddleware.html">IdentityMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/LiftMiddleware.html">LiftMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PublisherType.html">PublisherType</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ReduxPipelineWrapper.html">ReduxPipelineWrapper</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ReplayLastSubjectType.html">ReplayLastSubjectType</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ShouldEmitValue.html">ShouldEmitValue</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SubjectType.html">SubjectType</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SubscriberType.html">SubscriberType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other%20Typealiases.html">Other Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Other%20Typealiases.html#/s:8SwiftRex15StoreProjectiona">StoreProjection</a>
              </li>
              <li class="nav-group-task">
                <a href="Other%20Typealiases.html#/s:8SwiftRex23UnfailablePublisherTypea">UnfailablePublisherType</a>
              </li>
              <li class="nav-group-task">
                <a href="Other%20Typealiases.html#/s:8SwiftRex31UnfailableReplayLastSubjectTypea">UnfailableReplayLastSubjectType</a>
              </li>
              <li class="nav-group-task">
                <a href="Other%20Typealiases.html#/s:8SwiftRex17UnfailableSubjecta">UnfailableSubject</a>
              </li>
              <li class="nav-group-task">
                <a href="Other%20Typealiases.html#/s:8SwiftRex24UnfailableSubscriberTypea">UnfailableSubscriberType</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            <h1>Reducer</h1>
            
          </section>
          <section class="section task-group-section">
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8SwiftRex7ReducerV"></a>
                    <a name="//apple_ref/swift/Struct/Reducer" class="dashAnchor"></a>
                    <a class="token" href="#/s:8SwiftRex7ReducerV">Reducer</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>⚙ <code>Reducer</code> is a pure function wrapped in a monoid container, that takes an action and the current state to calculate
the new state.</p>

<p>The <code><a href="Protocols/Middleware.html">Middleware</a></code> pipeline will be notified about actions, or even trigger new ones, but what they can NOT do is
changing the app state. Middlewares have read-only access to the up-to-date state of our apps, but when mutations are
required we must use the <code>Reducer</code> function:</p>
<pre class="highlight swift"><code><span class="p">(</span><span class="kt">ActionType</span><span class="p">,</span> <span class="kt">StateType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">StateType</span>
</code></pre>

<p>Given an action and the current state, returns the calculated state. This function will be executed in the last stage
of an action handling, when all middlewares had the chance to read the action and start their own side-effects.</p>

<p>It&rsquo;s important to understand that reducer is a synchronous operations that calculates a new state without any kind of
side-effect, so never add properties to the <code>Reducer</code> structs or call any external function. If you are tempted to do
that, please create a middleware. Reducers are also responsible for keeping the consistency of a state, so it&rsquo;s always
good to do a final sanity check before changing the state, like for example check other dependant properties that must
be changed together.</p>

<p>Once the reducer function executes, the store will update its single source of truth with the new calculated state,
and propagate it to all its observers, that will react to the new state and update Views, for example.</p>

<p>This function is wrapped in a struct to overcome some Swift limitations, for example, allowing us to compose multiple
reducers into one (monoid operation, where two or more reducers become a single one) or lifting reducers from local
types to global types. The ability to lift reducers allow us to create small reducers, specialized in parts of our
state only, written in different frameworks and modules, and later plugged into a bigger state and action handler by
providing a way to map state and actions between the global and local ones. For more information about that, please
check the functions <code>lift(actionGetter:stateGetter:stateSetter:)</code> and <code>lift(action:state:)</code>.</p>

<p>A possible implementation of a reducer would be:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">volumeReducer</span> <span class="o">=</span> <span class="kt">Reducer</span><span class="o">&lt;</span><span class="kt">VolumeAction</span><span class="p">,</span> <span class="kt">VolumeState</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span> <span class="n">action</span><span class="p">,</span> <span class="n">currentState</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">action</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">louder</span><span class="p">:</span>
        <span class="k">return</span> <span class="kt">VolumeState</span><span class="p">(</span>
            <span class="nv">isMute</span><span class="p">:</span> <span class="n">currentState</span><span class="o">.</span><span class="n">isMute</span><span class="p">,</span>
            <span class="nv">volume</span><span class="p">:</span> <span class="nf">min</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">volume</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">quieter</span><span class="p">:</span>
        <span class="k">return</span> <span class="kt">VolumeState</span><span class="p">(</span>
            <span class="nv">isMute</span><span class="p">:</span> <span class="n">currentState</span><span class="o">.</span><span class="n">isMute</span><span class="p">,</span>
            <span class="nv">volume</span><span class="p">:</span> <span class="nf">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">volume</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">toggleMute</span><span class="p">:</span>
        <span class="k">return</span> <span class="kt">VolumeState</span><span class="p">(</span>
            <span class="nv">isMute</span><span class="p">:</span> <span class="o">!</span><span class="n">currentState</span><span class="o">.</span><span class="n">isMute</span><span class="p">,</span>
            <span class="nv">volume</span><span class="p">:</span> <span class="n">currentState</span><span class="o">.</span><span class="n">volume</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Please notice from the example above the following good practices:</p>

<ul>
<li>No <code>DispatchQueue</code>, threading, operation queue, promises, reactive code in there</li>
<li>All you need to implement this function is provided by the arguments <code>action</code> and <code>currentState</code>, don&rsquo;t use any other
variable coming from global scope, not even for reading purposes. If you need something else, it should be in the state</li>
<li>Do not start side-effects, requests, I/O, database calls</li>
<li>Avoid <code>default</code> when writing <code>switch</code>/<code>case</code> statements. That way the compiler will help you more</li>
<li>Make the action and the state generic parameters as much specialized as you can. If volume state is part of a bigger
state, you should not be tempted to pass the whole big state into this reducer. Make it short, brief and specialized,
this also helps preventing <code>default</code> case or having to re-assign properties that are never mutated by this reducer.
<code>
              ┌─────┐                                                                                        ┌─────┐
              │     │     handle   ┌──────────┐ request      ┌ ─ ─ ─ ─  response     ┌──────────┐ dispatch   │     │
              │     │   ┌─────────▶│Middleware├─────────────▶ External│─────────────▶│Middleware│───────────▶│Store│─ ─ ▶ ...
              │     │   │ Action   │ Pipeline │ side-effects │ World    side-effects │ callback │ New Action │     │
              │     │   │          └──────────┘               ─ ─ ─ ─ ┘              └──────────┘            └─────┘
┌──────┐ dispatch │     │   │
│Button│─────────▶│Store│──▶│                                                         ┌────────┐
└──────┘ Action   │     │   │                                                      ┌─▶│ View 1 │
              │     │   │                                  ┌─────┐             │  └────────┘
              │     │   │ reduce   ┌──────────┐            │     │ onNext      │  ┌────────┐
              │     │   └─────────▶│ Reducer  ├───────────▶│Store│────────────▶├─▶│ View 2 │
              │     │     Action   │ Pipeline │ New state  │     │ New state   │  └────────┘
              └─────┘     +        └──────────┘            └─────┘             │  ┌────────┐
                          State                                                └─▶│ View 3 │
                                                                                  └────────┘
</code></li>
</ul>

                        <a href="Structs/Reducer.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">struct</span> <span class="kt">Reducer</span><span class="o">&lt;</span><span class="kt">ActionType</span><span class="p">,</span> <span class="kt">StateType</span><span class="o">&gt;</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </section>
        </section>
        <section id="footer">
          <p>&copy; 2020 <a class="link" href="https://github.com/SwiftRex/SwiftRex" target="_blank" rel="external">SwiftRex</a>. All rights reserved. (Last updated: 2020-02-09)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.11.2</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
